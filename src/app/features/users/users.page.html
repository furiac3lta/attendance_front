<div class="container">

  <h2 class="title">ğŸ‘¥ GestiÃ³n de Usuarios</h2>

  <form [formGroup]="form" (ngSubmit)="saveUser()" class="form">

    <input type="text" formControlName="username" placeholder="Nombre completo" required>
    <input type="email" formControlName="email" placeholder="Correo electrÃ³nico" required>
    <input type="password" formControlName="password" placeholder="ContraseÃ±a" [required]="!editingUserId">

    <select formControlName="role">
      <option value="USER">Usuario</option>
      <option value="INSTRUCTOR">Instructor</option>
      <option value="ADMIN">Administrador</option>
    </select>

    <select *ngIf="currentRole === 'SUPER_ADMIN'" formControlName="organizationId">
      <option value="">-- Seleccionar organizaciÃ³n --</option>
      <option *ngFor="let org of organizations" [value]="org.id">{{ org.name }}</option>
    </select>

    <div class="actions">
      <button class="btn-primary" type="submit">
        {{ editingUserId ? 'ğŸ’¾ Guardar Cambios' : 'â• Crear Usuario' }}
      </button>

      <button *ngIf="editingUserId" class="btn-secondary" type="button" (click)="cancelEdit()">âŒ Cancelar</button>
    </div>

  </form>

  <hr>

  <table class="table">
    <thead>
      <tr>
        <th>ID</th><th>Nombre</th><th>Email</th><th>Rol</th><th>OrganizaciÃ³n</th><th>Cursos</th><th>Asignar</th><th>Acciones</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let u of users">
        <td>{{ u.id }}</td>
        <td>{{ u.fullName }}</td>
        <td>{{ u.email }}</td>
        <td>{{ u.role }}</td>
<td>{{ u.organizationName || 'Sin asignar' }}</td>

        <td>
          <ng-container *ngIf="u.courses?.length; else noCourses">
<span *ngFor="let c of u.courses" class="chip">{{ c }}</span>
          </ng-container>
          <ng-template #noCourses><span class="no-courses">Sin cursos</span></ng-template>
        </td>

        <td>
          <select multiple (change)="onCoursesChange(u.id, $event)">
            <option *ngFor="let c of courses" [value]="c.id">{{ c.name }}</option>
          </select>
          <button class="btn-small" (click)="saveCourses(u.id)">ğŸ’¾</button>
        </td>

        <td>
          <button class="btn-warning" (click)="editUser(u)">âœï¸</button>
          <button class="btn-danger" (click)="deleteUser(u.id)">ğŸ—‘ï¸</button>
        </td>
      </tr>
    </tbody>
  </table>

</div>

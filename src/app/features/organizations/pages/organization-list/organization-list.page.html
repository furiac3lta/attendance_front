<div class="container">

  <h2 class="title">üè¢ Organizaciones</h2>

  <!-- Si no hay -->
  <div *ngIf="!organizations.length" class="alert alert-info">
    No hay organizaciones registradas.
  </div>

  <!-- Tabla Material -->
  <table mat-table [dataSource]="organizations" class="table-modern">

    <!-- Nombre -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Nombre </th>
      <td mat-cell *matCellDef="let org"> {{ org.name }} </td>
    </ng-container>

    <!-- Tipo -->
    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef> Tipo </th>
      <td mat-cell *matCellDef="let org"> {{ org.type }} </td>
    </ng-container>

    <!-- Tel√©fono -->
    <ng-container matColumnDef="phone">
      <th mat-header-cell *matHeaderCellDef> Tel√©fono </th>
      <td mat-cell *matCellDef="let org"> {{ org.phone }} </td>
    </ng-container>

    <!-- Direcci√≥n -->
    <ng-container matColumnDef="address">
      <th mat-header-cell *matHeaderCellDef> Direcci√≥n </th>
      <td mat-cell *matCellDef="let org"> {{ org.address }} </td>
    </ng-container>

    <!-- Admin actual -->
    <ng-container matColumnDef="admin">
      <th mat-header-cell *matHeaderCellDef> Admin actual </th>
      <td mat-cell *matCellDef="let org">
        <ng-container *ngIf="org.adminFullName; else noAdmin">
          {{ org.adminFullName }}
        </ng-container>
        <ng-template #noAdmin> <em class="text-muted">Sin asignar</em> </ng-template>
      </td>
    </ng-container>

    <!-- Select para reasignar -->
    <ng-container *ngIf="userRole === 'SUPER_ADMIN'" matColumnDef="selectAdmin">
      <th mat-header-cell *matHeaderCellDef> Asignar nuevo administrador </th>
      <td mat-cell *matCellDef="let org">

        <mat-select [(ngModel)]="selectedAdmin[org.id]" placeholder="Seleccionar..." style="width:180px">
          <mat-option [value]="null">Seleccionar...</mat-option>
          <mat-option *ngFor="let admin of admins" [value]="admin.id">
            {{ admin.fullName }}
          </mat-option>
        </mat-select>

      </td>
    </ng-container>

    <!-- Acciones -->
    <ng-container *ngIf="userRole === 'SUPER_ADMIN'" matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Acciones </th>
      <td mat-cell *matCellDef="let org">

        <button button mat-stroked-button color="primary"  class="me-2"
          (click)="assignAdmin(org.id)" [disabled]="!selectedAdmin[org.id]">
          <mat-icon>person_add</mat-icon> Asignar
        </button>

        <button mat-stroked-button color="accent" style="margin-left: 6px;"
          (click)="deleteOrganization(org.id)">
          <mat-icon>delete</mat-icon> Eliminar
        </button>

      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

  </table>

  <!-- Crear nueva -->
  <button *ngIf="userRole === 'SUPER_ADMIN'" mat-fab color="primary" class="add-btn" routerLink="/organizations/new">
    <mat-icon>add</mat-icon>
  </button>

</div>
